<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teatro JSON</title>
</head>
<body>
    <select id="desplegable">
    </select>
    <div>Título: <input id="titulo"></input></div>
    <div>Precio: <input id="precio"></input></div>
    <div>Sinopsis: <textarea id="sinopsis" cols="40"></textarea></div>
    <br>
    <button id="pri">Primero</button>
    <button id="ant">Anterior</button>
    <button id="sig">Siguiente</button>
    <button id="ult">Último</button>
    <div><img id="imagen" src=""></img></div>
    

    <script>
        let select = document.getElementById("desplegable");
        let inputTitulo = document.getElementById("titulo");
        let inputPrecio = document.getElementById("precio");
        let textSinopsis = document.getElementById("sinopsis");
        let img = document.getElementById("imagen");

        select.addEventListener("change", carteleraTeatro);

        async function cargarTeatros() {
            let fichero = "./json_teatro/teatros.json";
            let respuesta = await fetch(fichero);
            if (respuesta.ok) {
                try {
                    json = await respuesta.json();
                    let teatros = json;
                        for (let teatro of teatros){
                            let option = document.createElement("option");
                            option.textContent = teatro.teatro;
                            select.append(option);
                        }
                    carteleraTeatro();
                } catch (error) {
                    alert(error.message);
                }
            } else {
                alert(
                    "Error " +
                    respuesta.status +
                    " al intentar acceder al fichero " +
                    fichero
                );
            }
        }
        cargarTeatros();
        
        function carteleraTeatro(){
            fetch("./json_teatro/cartelera.json")
                .then(function (response) {
                    if (response.ok) {
                    return response.json();
                    } else {
                    throw new Error("Error " +
                        response.status +
                        " al intentar acceder al fichero " +
                        fichero)
                    }
                })
                .then(function (json) {
                    let cartelera = json;
                    for (let obra of cartelera.obras){
                        if(obra.teatro == select.value){
                            inputTitulo.value = obra.titulo;
                            inputPrecio.value = obra.precio;
                            textSinopsis.textContent = obra.sinopsis;
                            textSinopsis.style.height = `${textSinopsis.scrollHeight}px`
                            img.src = obra.imagen;
                        }
                    }
                })
        }

        

    </script>
</body>
</html>